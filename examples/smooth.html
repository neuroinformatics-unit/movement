
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Smooth pose tracks &#8212; movement</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=9c66c473" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=8bafd125"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/smooth';</script>
    <link rel="canonical" href="https://movement.neuroinformatics.dev/examples/smooth.html" />
    <link rel="icon" href="../_static/light-logo-niu.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Compute and visualise kinematics." href="compute_kinematics.html" />
    <link rel="prev" title="Drop outliers and interpolate" href="filter_and_interpolate.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">movement v0.0.18</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../community/index.html">
    Community
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../api_index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/neuroinformatics-unit/movement" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://neuroinformatics.zulipchat.com/#narrow/stream/406001-Movement" title="Zulip (chat)" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-comments fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Zulip (chat)</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../community/index.html">
    Community
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../api_index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/neuroinformatics-unit/movement" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://neuroinformatics.zulipchat.com/#narrow/stream/406001-Movement" title="Zulip (chat)" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-comments fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Zulip (chat)</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="load_and_explore_poses.html">Load and explore pose tracks</a></li>
<li class="toctree-l1"><a class="reference internal" href="filter_and_interpolate.html">Drop outliers and interpolate</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Smooth pose tracks</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute_kinematics.html">Compute and visualise kinematics.</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute_polar_coordinates.html">Express 2D vectors in polar coordinates</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Smooth pose tracks</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-smooth-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code. or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="smooth-pose-tracks">
<span id="sphx-glr-examples-smooth-py"></span><h1>Smooth pose tracks<a class="headerlink" href="#smooth-pose-tracks" title="Link to this heading">#</a></h1>
<p>Smooth pose tracks using the median and Savitzky-Golay filters.</p>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">welch</span>

<span class="kn">from</span> <span class="nn">movement</span> <span class="kn">import</span> <span class="n">sample_data</span>
<span class="kn">from</span> <span class="nn">movement.filtering</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">interpolate_over_time</span><span class="p">,</span>
    <span class="n">median_filter</span><span class="p">,</span>
    <span class="n">savgol_filter</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="load-a-sample-dataset">
<h2>Load a sample dataset<a class="headerlink" href="#load-a-sample-dataset" title="Link to this heading">#</a></h2>
<p>Let’s load a sample dataset and print it to inspect its contents.
Note that if you are running this notebook interactively, you can simply
type the variable name (here <code class="docutils literal notranslate"><span class="pre">ds_wasp</span></code>) in a cell to get an interactive
display of the dataset’s contents.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_wasp</span> <span class="o">=</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">fetch_dataset</span><span class="p">(</span><span class="s2">&quot;DLC_single-wasp.predictions.h5&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_wasp</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt; Size: 61kB
Dimensions:      (time: 1085, individuals: 1, keypoints: 2, space: 2)
Coordinates:
  * time         (time) float64 9kB 0.0 0.025 0.05 0.075 ... 27.05 27.07 27.1
  * individuals  (individuals) &lt;U12 48B &#39;individual_0&#39;
  * keypoints    (keypoints) &lt;U7 56B &#39;head&#39; &#39;stinger&#39;
  * space        (space) &lt;U1 8B &#39;x&#39; &#39;y&#39;
Data variables:
    position     (time, individuals, keypoints, space) float64 35kB 1.086e+03...
    confidence   (time, individuals, keypoints) float64 17kB 0.05305 ... 0.0
Attributes:
    fps:              40.0
    time_unit:        seconds
    source_software:  DeepLabCut
    source_file:      /home/runner/.movement/data/poses/DLC_single-wasp.predi...
    frame_path:       /home/runner/.movement/data/frames/single-wasp_frame-10...
    video_path:       None
</pre></div>
</div>
<p>We see that the dataset contains a single individual (a wasp) with two
keypoints tracked in 2D space. The video was recorded at 40 fps and lasts for
~27 seconds.</p>
</section>
<section id="define-a-plotting-function">
<h2>Define a plotting function<a class="headerlink" href="#define-a-plotting-function" title="Link to this heading">#</a></h2>
<p>Let’s define a plotting function to help us visualise the effects smoothing
both in the time and frequency domains.
The function takes as inputs two datasets containing raw and smooth data
respectively, and plots the position time series and power spectral density
(PSD) for a given individual and keypoint. The function also allows you to
specify the spatial coordinate (<code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y</span></code>) and a time range to focus on.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_raw_and_smooth_timeseries_and_psd</span><span class="p">(</span>
    <span class="n">ds_raw</span><span class="p">,</span>
    <span class="n">ds_smooth</span><span class="p">,</span>
    <span class="n">individual</span><span class="o">=</span><span class="s2">&quot;individual_0&quot;</span><span class="p">,</span>
    <span class="n">keypoint</span><span class="o">=</span><span class="s2">&quot;stinger&quot;</span><span class="p">,</span>
    <span class="n">space</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">time_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># If no time range is specified, plot the entire time series</span>
    <span class="k">if</span> <span class="n">time_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">time_range</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ds_raw</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">selection</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time_range</span><span class="p">,</span>
        <span class="s2">&quot;individuals&quot;</span><span class="p">:</span> <span class="n">individual</span><span class="p">,</span>
        <span class="s2">&quot;keypoints&quot;</span><span class="p">:</span> <span class="n">keypoint</span><span class="p">,</span>
        <span class="s2">&quot;space&quot;</span><span class="p">:</span> <span class="n">space</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">ds</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="p">[</span><span class="n">ds_raw</span><span class="p">,</span> <span class="n">ds_smooth</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="s2">&quot;smooth&quot;</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="c1"># plot position time series</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">selection</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">pos</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># generate interpolated dataset to avoid NaNs in the PSD calculation</span>
        <span class="n">ds_interp</span> <span class="o">=</span> <span class="n">interpolate_over_time</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">max_gap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">print_report</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">pos_interp</span> <span class="o">=</span> <span class="n">ds_interp</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">selection</span><span class="p">)</span>
        <span class="c1"># compute and plot the PSD</span>
        <span class="n">freq</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">welch</span><span class="p">(</span><span class="n">pos_interp</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span>
            <span class="n">freq</span><span class="p">,</span>
            <span class="n">psd</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s2"> position (px)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Time Domain&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;PSD (px$^2$/Hz)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Frequency Domain&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="smoothing-with-a-median-filter">
<h2>Smoothing with a median filter<a class="headerlink" href="#smoothing-with-a-median-filter" title="Link to this heading">#</a></h2>
<p>Here we use the <a class="reference internal" href="../api/movement.filtering.median_filter.html#movement.filtering.median_filter" title="movement.filtering.median_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">movement.filtering.median_filter()</span></code></a> function to
apply a rolling window median filter to the wasp dataset.
The <code class="docutils literal notranslate"><span class="pre">window_length</span></code> parameter is defined in seconds (according to the
<code class="docutils literal notranslate"><span class="pre">time_unit</span></code> dataset attribute).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_wasp_medfilt</span> <span class="o">=</span> <span class="n">median_filter</span><span class="p">(</span><span class="n">ds_wasp</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Missing points (marked as NaN) in input dataset:
        Individual: individual_0
                head: 0/1085 (0.0%)
                stinger: 0/1085 (0.0%)

Missing points (marked as NaN) in filtered dataset:
        Individual: individual_0
                head: 0/1085 (0.0%)
                stinger: 0/1085 (0.0%)
</pre></div>
</div>
<p>We see from the printed report that the dataset has no missing values
neither before nor after smoothing. Let’s visualise the effects of the
median filter in the time and frequency domains.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_raw_and_smooth_timeseries_and_psd</span><span class="p">(</span>
    <span class="n">ds_wasp</span><span class="p">,</span> <span class="n">ds_wasp_medfilt</span><span class="p">,</span> <span class="n">keypoint</span><span class="o">=</span><span class="s2">&quot;stinger&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_smooth_001.png" srcset="../_images/sphx_glr_smooth_001.png" alt="Time Domain, Frequency Domain" class = "sphx-glr-single-img"/><p>We see that the median filter has removed the “spikes” present around the
14 second mark in the raw data. However, it has not dealt the big shift
occurring during the final second. In the frequency domain, we can see that
the filter has reduced the power in the high-frequency components, without
affecting the low frequency components.</p>
<p>This illustrates what the median filter is good at: removing brief “spikes”
(e.g. a keypoint abruptly jumping to a different location for a frame or two)
and high-frequency “jitter” (often present due to pose estimation
working on a per-frame basis).</p>
<section id="choosing-parameters-for-the-median-filter">
<h3>Choosing parameters for the median filter<a class="headerlink" href="#choosing-parameters-for-the-median-filter" title="Link to this heading">#</a></h3>
<p>You can control the behaviour of <a class="reference internal" href="../api/movement.filtering.median_filter.html#movement.filtering.median_filter" title="movement.filtering.median_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">movement.filtering.median_filter()</span></code></a>
via two parameters: <code class="docutils literal notranslate"><span class="pre">window_length</span></code> and <code class="docutils literal notranslate"><span class="pre">min_periods</span></code>.
To better understand the effect of these parameters, let’s use a
dataset that contains missing values.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_mouse</span> <span class="o">=</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">fetch_dataset</span><span class="p">(</span><span class="s2">&quot;SLEAP_single-mouse_EPM.analysis.h5&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_mouse</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt; Size: 1MB
Dimensions:      (time: 18485, individuals: 1, keypoints: 6, space: 2)
Coordinates:
  * time         (time) float64 148kB 0.0 0.03333 0.06667 ... 616.1 616.1 616.1
  * individuals  (individuals) &lt;U12 48B &#39;individual_0&#39;
  * keypoints    (keypoints) &lt;U9 216B &#39;snout&#39; &#39;left_ear&#39; ... &#39;tail_end&#39;
  * space        (space) &lt;U1 8B &#39;x&#39; &#39;y&#39;
Data variables:
    position     (time, individuals, keypoints, space) float32 887kB nan ... ...
    confidence   (time, individuals, keypoints) float32 444kB nan nan ... 0.7607
Attributes:
    fps:              30.0
    time_unit:        seconds
    source_software:  SLEAP
    source_file:      /home/runner/.movement/data/poses/SLEAP_single-mouse_EP...
    frame_path:       /home/runner/.movement/data/frames/single-mouse_EPM_fra...
    video_path:       /home/runner/.movement/data/videos/single-mouse_EPM_vid...
</pre></div>
</div>
<p>The dataset contains a single mouse with six keypoints tracked in
2D space. The video was recorded at 30 fps and lasts for ~616 seconds. We can
see that there are some missing values, indicated as “nan” in the
printed dataset. Let’s apply the median filter to this dataset, with
the <code class="docutils literal notranslate"><span class="pre">window_length</span></code> set to 0.1 seconds.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_mouse_medfilt</span> <span class="o">=</span> <span class="n">median_filter</span><span class="p">(</span><span class="n">ds_mouse</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Missing points (marked as NaN) in input dataset:
        Individual: individual_0
                snout: 4494/18485 (24.3%)
                left_ear: 513/18485 (2.8%)
                right_ear: 533/18485 (2.9%)
                centre: 490/18485 (2.7%)
                tail_base: 704/18485 (3.8%)
                tail_end: 2496/18485 (13.5%)

Missing points (marked as NaN) in filtered dataset:
        Individual: individual_0
                snout: 5106/18485 (27.6%)
                left_ear: 678/18485 (3.7%)
                right_ear: 695/18485 (3.8%)
                centre: 640/18485 (3.5%)
                tail_base: 913/18485 (4.9%)
                tail_end: 3103/18485 (16.8%)
</pre></div>
</div>
<p>The report informs us that the raw data contains NaN values, most of which
occur at the <code class="docutils literal notranslate"><span class="pre">snout</span></code> and <code class="docutils literal notranslate"><span class="pre">tail_end</span></code> keypoints. After filtering, the
number of NaNs has increased. This is because the default behaviour of the
median filter is to propagate NaN values, i.e. if any value in the rolling
window is NaN, the output will also be NaN.</p>
<p>To modify this behaviour, you can set the value of the <code class="docutils literal notranslate"><span class="pre">min_periods</span></code>
parameter to an integer value. This parameter determines the minimum number
of non-NaN values required in the window for the output to be non-NaN.
For example, setting <code class="docutils literal notranslate"><span class="pre">min_periods=2</span></code> means that two non-NaN values in the
window are sufficient for the median to be calculated. Let’s try this.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_mouse_medfilt</span> <span class="o">=</span> <span class="n">median_filter</span><span class="p">(</span><span class="n">ds_mouse</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Missing points (marked as NaN) in input dataset:
        Individual: individual_0
                snout: 4494/18485 (24.3%)
                left_ear: 513/18485 (2.8%)
                right_ear: 533/18485 (2.9%)
                centre: 490/18485 (2.7%)
                tail_base: 704/18485 (3.8%)
                tail_end: 2496/18485 (13.5%)

Missing points (marked as NaN) in filtered dataset:
        Individual: individual_0
                snout: 4455/18485 (24.1%)
                left_ear: 487/18485 (2.6%)
                right_ear: 507/18485 (2.7%)
                centre: 465/18485 (2.5%)
                tail_base: 673/18485 (3.6%)
                tail_end: 2428/18485 (13.1%)
</pre></div>
</div>
<p>We see that this time the number of NaN values has decreased
across all keypoints.
Let’s visualise the effects of the median filter in the time and frequency
domains. Here we focus on the first 80 seconds for the <code class="docutils literal notranslate"><span class="pre">snout</span></code> keypoint.
You can adjust the <code class="docutils literal notranslate"><span class="pre">keypoint</span></code> and <code class="docutils literal notranslate"><span class="pre">time_range</span></code> arguments to explore other
parts of the data.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_raw_and_smooth_timeseries_and_psd</span><span class="p">(</span>
    <span class="n">ds_mouse</span><span class="p">,</span> <span class="n">ds_mouse_medfilt</span><span class="p">,</span> <span class="n">keypoint</span><span class="o">=</span><span class="s2">&quot;snout&quot;</span><span class="p">,</span> <span class="n">time_range</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_smooth_002.png" srcset="../_images/sphx_glr_smooth_002.png" alt="Time Domain, Frequency Domain" class = "sphx-glr-single-img"/><p>The smoothing once again reduces the power of high-frequency components, but
the resulting time series stays quite close to the raw data.</p>
<p>What happens if we increase the <code class="docutils literal notranslate"><span class="pre">window_length</span></code> to 2 seconds?</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_mouse_medfilt</span> <span class="o">=</span> <span class="n">median_filter</span><span class="p">(</span><span class="n">ds_mouse</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Missing points (marked as NaN) in input dataset:
        Individual: individual_0
                snout: 4494/18485 (24.3%)
                left_ear: 513/18485 (2.8%)
                right_ear: 533/18485 (2.9%)
                centre: 490/18485 (2.7%)
                tail_base: 704/18485 (3.8%)
                tail_end: 2496/18485 (13.5%)

Missing points (marked as NaN) in filtered dataset:
        Individual: individual_0
                snout: 795/18485 (4.3%)
                left_ear: 80/18485 (0.4%)
                right_ear: 80/18485 (0.4%)
                centre: 80/18485 (0.4%)
                tail_base: 80/18485 (0.4%)
                tail_end: 239/18485 (1.3%)
</pre></div>
</div>
<p>The number of NaN values has decreased even further. That’s because the
chance of finding at least 2 valid values within a 2 second window is
quite high. Let’s plot the results for the same keypoint and time range
as before.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_raw_and_smooth_timeseries_and_psd</span><span class="p">(</span>
    <span class="n">ds_mouse</span><span class="p">,</span> <span class="n">ds_mouse_medfilt</span><span class="p">,</span> <span class="n">keypoint</span><span class="o">=</span><span class="s2">&quot;snout&quot;</span><span class="p">,</span> <span class="n">time_range</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_smooth_003.png" srcset="../_images/sphx_glr_smooth_003.png" alt="Time Domain, Frequency Domain" class = "sphx-glr-single-img"/><p>We see that the filtered time series is much smoother and it has even
“bridged” over some small gaps. That said, it often deviates from the raw
data, in ways that may not be desirable, depending on the application.
That means that our choice of <code class="docutils literal notranslate"><span class="pre">window_length</span></code> may be too large.
In general, you should choose a <code class="docutils literal notranslate"><span class="pre">window_length</span></code> that is small enough to
preserve the original data structure, but large enough to remove
“spikes” and high-frequency noise. Always inspect the results to ensure
that the filter is not removing important features.</p>
</section>
</section>
<section id="smoothing-with-a-savitzky-golay-filter">
<h2>Smoothing with a Savitzky-Golay filter<a class="headerlink" href="#smoothing-with-a-savitzky-golay-filter" title="Link to this heading">#</a></h2>
<p>Here we use the <a class="reference internal" href="../api/movement.filtering.savgol_filter.html#movement.filtering.savgol_filter" title="movement.filtering.savgol_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">movement.filtering.savgol_filter()</span></code></a> function,
which is a wrapper around <code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.savgol_filter()</span></code>.
The Savitzky-Golay filter is a polynomial smoothing filter that can be
applied to time series data on a rolling window basis. A polynomial of
degree <code class="docutils literal notranslate"><span class="pre">polyorder</span></code> is fitted to the data in each window of length
<code class="docutils literal notranslate"><span class="pre">window_length</span></code>, and the value of the polynomial at the center of the
window is used as the output value.</p>
<p>Let’s try it on the mouse dataset.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_mouse_savgol</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">ds_mouse</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Missing points (marked as NaN) in input dataset:
        Individual: individual_0
                snout: 4494/18485 (24.3%)
                left_ear: 513/18485 (2.8%)
                right_ear: 533/18485 (2.9%)
                centre: 490/18485 (2.7%)
                tail_base: 704/18485 (3.8%)
                tail_end: 2496/18485 (13.5%)

Missing points (marked as NaN) in filtered dataset:
        Individual: individual_0
                snout: 5810/18485 (31.4%)
                left_ear: 895/18485 (4.8%)
                right_ear: 905/18485 (4.9%)
                centre: 839/18485 (4.5%)
                tail_base: 1186/18485 (6.4%)
                tail_end: 3801/18485 (20.6%)
</pre></div>
</div>
<p>We see that the number of NaN values has increased after filtering. This is
for the same reason as with the median filter (in its default mode), i.e.
if there is at least one NaN value in the window, the output will be NaN.
Unlike the median filter, the Savitzky-Golay filter does not provide a
<code class="docutils literal notranslate"><span class="pre">min_periods</span></code> parameter to control this behaviour. Let’s visualise the
effects in the time and frequency domains.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_raw_and_smooth_timeseries_and_psd</span><span class="p">(</span>
    <span class="n">ds_mouse</span><span class="p">,</span> <span class="n">ds_mouse_savgol</span><span class="p">,</span> <span class="n">keypoint</span><span class="o">=</span><span class="s2">&quot;snout&quot;</span><span class="p">,</span> <span class="n">time_range</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_smooth_004.png" srcset="../_images/sphx_glr_smooth_004.png" alt="Time Domain, Frequency Domain" class = "sphx-glr-single-img"/><p>Once again, the power of high-frequency components has been reduced, but more
missing values have been introduced.</p>
<p>Now let’s take a look at the wasp dataset.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_wasp_savgol</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">ds_wasp</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Missing points (marked as NaN) in input dataset:
        Individual: individual_0
                head: 0/1085 (0.0%)
                stinger: 0/1085 (0.0%)

Missing points (marked as NaN) in filtered dataset:
        Individual: individual_0
                head: 0/1085 (0.0%)
                stinger: 0/1085 (0.0%)
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_raw_and_smooth_timeseries_and_psd</span><span class="p">(</span>
    <span class="n">ds_wasp</span><span class="p">,</span>
    <span class="n">ds_wasp_savgol</span><span class="p">,</span>
    <span class="n">keypoint</span><span class="o">=</span><span class="s2">&quot;stinger&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_smooth_005.png" srcset="../_images/sphx_glr_smooth_005.png" alt="Time Domain, Frequency Domain" class = "sphx-glr-single-img"/><p>This example shows two important limitations of the Savitzky-Golay filter.
First, the filter can introduce artefacts around sharp boundaries. For
example, focus on what happens around the sudden drop in position
during the final second. Second, the PSD appears to have large periodic
drops at certain frequencies. Both of these effects vary with the
choice of <code class="docutils literal notranslate"><span class="pre">window_length</span></code> and <code class="docutils literal notranslate"><span class="pre">polyorder</span></code>. You can read more about these
and other limitations of the Savitzky-Golay filter in
<a class="reference external" href="https://pubs.acs.org/doi/10.1021/acsmeasuresciau.1c00054">this paper</a>.</p>
</section>
<section id="combining-multiple-smoothing-filters">
<h2>Combining multiple smoothing filters<a class="headerlink" href="#combining-multiple-smoothing-filters" title="Link to this heading">#</a></h2>
<p>You can also combine multiple smoothing filters by applying them
sequentially. For example, we can first apply the median filter with a small
<code class="docutils literal notranslate"><span class="pre">window_length</span></code> to remove “spikes” and then apply the Savitzky-Golay filter
with a larger <code class="docutils literal notranslate"><span class="pre">window_length</span></code> to further smooth the data.
Between the two filters, we can interpolate over small gaps to avoid the
excessive proliferation of NaN values. Let’s try this on the mouse dataset.
First, let’s apply the median filter.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_mouse_medfilt</span> <span class="o">=</span> <span class="n">median_filter</span><span class="p">(</span><span class="n">ds_mouse</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Missing points (marked as NaN) in input dataset:
        Individual: individual_0
                snout: 4494/18485 (24.3%)
                left_ear: 513/18485 (2.8%)
                right_ear: 533/18485 (2.9%)
                centre: 490/18485 (2.7%)
                tail_base: 704/18485 (3.8%)
                tail_end: 2496/18485 (13.5%)

Missing points (marked as NaN) in filtered dataset:
        Individual: individual_0
                snout: 4455/18485 (24.1%)
                left_ear: 487/18485 (2.6%)
                right_ear: 507/18485 (2.7%)
                centre: 465/18485 (2.5%)
                tail_base: 673/18485 (3.6%)
                tail_end: 2428/18485 (13.1%)
</pre></div>
</div>
<p>Next, let’s linearly interpolate over gaps smaller than 1 second.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_mouse_medfilt_interp</span> <span class="o">=</span> <span class="n">interpolate_over_time</span><span class="p">(</span><span class="n">ds_mouse_medfilt</span><span class="p">,</span> <span class="n">max_gap</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Missing points (marked as NaN) in input dataset:
        Individual: individual_0
                snout: 4455/18485 (24.1%)
                left_ear: 487/18485 (2.6%)
                right_ear: 507/18485 (2.7%)
                centre: 465/18485 (2.5%)
                tail_base: 673/18485 (3.6%)
                tail_end: 2428/18485 (13.1%)

Missing points (marked as NaN) in interpolated dataset:
        Individual: individual_0
                snout: 3011/18485 (16.3%)
                left_ear: 257/18485 (1.4%)
                right_ear: 294/18485 (1.6%)
                centre: 257/18485 (1.4%)
                tail_base: 257/18485 (1.4%)
                tail_end: 1191/18485 (6.4%)
</pre></div>
</div>
<p>Finally, let’s apply the Savitzky-Golay filter.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_mouse_medfilt_interp_savgol</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span>
    <span class="n">ds_mouse_medfilt_interp</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Missing points (marked as NaN) in input dataset:
        Individual: individual_0
                snout: 3011/18485 (16.3%)
                left_ear: 257/18485 (1.4%)
                right_ear: 294/18485 (1.6%)
                centre: 257/18485 (1.4%)
                tail_base: 257/18485 (1.4%)
                tail_end: 1191/18485 (6.4%)

Missing points (marked as NaN) in filtered dataset:
        Individual: individual_0
                snout: 3520/18485 (19.0%)
                left_ear: 306/18485 (1.7%)
                right_ear: 354/18485 (1.9%)
                centre: 306/18485 (1.7%)
                tail_base: 306/18485 (1.7%)
                tail_end: 1427/18485 (7.7%)
</pre></div>
</div>
<p>A record of all applied operations is stored in the dataset’s <code class="docutils literal notranslate"><span class="pre">log</span></code>
attribute. Let’s inspect it to summarise what we’ve done.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">ds_mouse_medfilt_interp_savgol</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;operation&#39;: &#39;median_filter&#39;, &#39;datetime&#39;: &#39;2024-06-03 14:57:27.824037&#39;, &#39;window_length&#39;: 0.1, &#39;min_periods&#39;: 2}
{&#39;operation&#39;: &#39;interpolate_over_time&#39;, &#39;datetime&#39;: &#39;2024-06-03 14:57:27.861355&#39;, &#39;max_gap&#39;: 1}
{&#39;operation&#39;: &#39;savgol_filter&#39;, &#39;datetime&#39;: &#39;2024-06-03 14:57:27.877473&#39;, &#39;window_length&#39;: 0.4, &#39;polyorder&#39;: 2}
</pre></div>
</div>
<p>Now let’s visualise the difference between the raw data and the final
smoothed result.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_raw_and_smooth_timeseries_and_psd</span><span class="p">(</span>
    <span class="n">ds_mouse</span><span class="p">,</span>
    <span class="n">ds_mouse_medfilt_interp_savgol</span><span class="p">,</span>
    <span class="n">keypoint</span><span class="o">=</span><span class="s2">&quot;snout&quot;</span><span class="p">,</span>
    <span class="n">time_range</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_smooth_006.png" srcset="../_images/sphx_glr_smooth_006.png" alt="Time Domain, Frequency Domain" class = "sphx-glr-single-img"/><p>Feel free to play around with the parameters of the applied filters and to
also look at other keypoints and time ranges.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 1.534 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-smooth-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/neuroinformatics-unit/movement/gh-pages?filepath=notebooks/examples/smooth.ipynb"><img alt="Launch binder" src="../_images/binder_badge_logo.svg" width="150px" /></a>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/844e74b700fac354e52a59dbe7329a84/smooth.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">smooth.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/07f4b1b69497c93530bbe772d7eb535a/smooth.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">smooth.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="filter_and_interpolate.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Drop outliers and interpolate</p>
      </div>
    </a>
    <a class="right-next"
       href="compute_kinematics.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Compute and visualise kinematics.</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-a-sample-dataset">Load a sample dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-plotting-function">Define a plotting function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothing-with-a-median-filter">Smoothing with a median filter</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-parameters-for-the-median-filter">Choosing parameters for the median filter</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothing-with-a-savitzky-golay-filter">Smoothing with a Savitzky-Golay filter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-multiple-smoothing-filters">Combining multiple smoothing filters</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/examples/smooth.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item"><p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
    </p>
    <p class="theme-version">
    Built with the
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a>
    0.15.3.
    </p></div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><div class="things-in-a-row">
    <a href="https://neuroinformatics.dev/">
        <img src="../_static/light-logo-niu.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../_static/dark-logo-niu.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
    <a href="https://www.sainsburywellcome.org/web/">
        <img src="../_static/light-logo-swc.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../_static/dark-logo-swc.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
    <a href="https://www.ucl.ac.uk/gatsby/gatsby-computational-neuroscience-unit">
        <img src="../_static/light-logo-gatsby.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../_static/dark-logo-gatsby.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
    <a href="https://www.ucl.ac.uk/">
        <img src="../_static/light-logo-ucl.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../_static/dark-logo-ucl.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
</div></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>